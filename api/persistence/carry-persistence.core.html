<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>carry-persistence.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Carry-persistence</span> <span class="project-version">0.4.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="carry-persistence.core.html"><div class="inner"><span>carry-persistence.core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="carry-persistence.core.html#var-add"><div class="inner"><span>add</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">carry-persistence.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-add"><h3>add</h3><div class="usage"><code>(add spec storage key)</code><code>(add spec storage key {:keys [blacklist load-wrapper], :or {blacklist #{}, load-wrapper identity}, :as _options})</code></div><div class="doc"><div class="markdown"><p>On start the middleware will load model from the specified storage. Saves model into storage on every change. Multiple middleware can safely wrap the same spec as long as different storage keys are specified.</p>
<p>Storage is expected to be a transient map (e.g. as provided by <a href="https://github.com/funcool/hodgepodge">hodgepodge</a>). If this middleware is applied to spec several times then all keys must differ; otherwise, behavior is undefined.</p>
<p>Optional <code>:blacklist</code> set should contain model keys which will not be saved and loaded.</p>
<p>Optional <code>:load-wrapper</code> allows decorating model update function (e.g. it’s possible to cancel loading based on loaded data). Wrapper example:</p>
<pre><code class="clj">(defn -wrap-load-from-storage
  [load-from-storage]
  (fn wrapped-load-from-storage
    [model loaded-model dispatch-signal]
    ; load only if user set the flag during previous session
    (when (-&gt; loaded-model :persist?)
      (load-from-storage model loaded-model dispatch-signal)
      (dispatch-signal :on-did-load-from-storage))))
</code></pre>
<p>Middleware is friendly to <code>carry-debugger</code>:</p>
<ul>
  <li>it won’t persist debugger data in order to not conflict with debugger’s persistence implementation</li>
  <li>it won’t load model from storage on app start if debugger’s replay mode is on</li>
</ul></div></div><div class="src-link"><a href="https://github.com/metametadata/carry/blob/master/contrib/persistence/src/carry_persistence/core.cljs#L59">view source</a></div></div></div></body></html>